# MT25077
# PA02: Analysis of Network I/O Primitives using "perf" Tool
# Course: Graduate Systems (CSE638)
# Author: MT25077

## Overview

This project implements and compares three TCP socket communication strategies
to study the cost of data movement in network I/O:

  A1. Two-Copy  : send()/recv() with user-space serialization
  A2. One-Copy  : sendmsg() with scatter-gather iovec (no serialization copy)
  A3. Zero-Copy : sendmsg() with MSG_ZEROCOPY (no user-to-kernel copy)

Each implementation consists of a multithreaded server (sends structured
messages with 8 dynamically allocated string fields) and a multithreaded
client (receives and measures throughput/latency).

## File Listing

  MT25077_Part_A_Common.h            - Shared definitions and utilities
  MT25077_Part_A1_Server.c           - Two-copy server (send)
  MT25077_Part_A1_Client.c           - Two-copy client (recv)
  MT25077_Part_A2_Server.c           - One-copy server (sendmsg + iovec)
  MT25077_Part_A2_Client.c           - One-copy client (recv)
  MT25077_Part_A3_Server.c           - Zero-copy server (MSG_ZEROCOPY)
  MT25077_Part_A3_Client.c           - Zero-copy client (recv)
  MT25077_Part_C_ExperimentScript.sh - Automated experiment runner (Part C)
  MT25077_Part_D_Plots.py            - Matplotlib plotting script (Part D)
  MT25077_Part_B_Results.csv         - Raw CSV data (generated by experiment script)
  MT25077_Part_B_SystemInfo.txt      - System configuration (generated by experiment script)
  Makefile                           - Build system
  README                             - This file

## Build

  make          # Compile all 6 binaries
  make clean    # Remove binaries

## Manual Usage

  Server (run in one terminal/namespace):
    ./a1_server <port> <message_size_bytes>
    ./a2_server <port> <message_size_bytes>
    ./a3_server <port> <message_size_bytes>

  Client (run in another terminal/namespace):
    ./a1_client <server_ip> <port> <msg_size> <thread_count> [duration_s]
    ./a2_client <server_ip> <port> <msg_size> <thread_count> [duration_s]
    ./a3_client <server_ip> <port> <msg_size> <thread_count> [duration_s]

  Example (two-copy, 64KB messages, 4 threads, 10 seconds):
    Terminal 1: ./a1_server 9000 65536
    Terminal 2: ./a1_client 127.0.0.1 9000 65536 4 10

## Running Experiments (Automated)

  The experiment script sets up network namespaces, runs all experiments
  across message sizes (1KB, 4KB, 64KB, 1MB) and thread counts (1, 2, 4, 8),
  collects perf stat metrics, and outputs CSV results.

  sudo bash MT25077_Part_C_ExperimentScript.sh

  Prerequisites:
    - Root access (for network namespaces and perf)
    - perf tool installed: sudo apt install linux-tools-$(uname -r)
    - gcc and make
    - python3 with matplotlib: sudo apt install python3-matplotlib

## Generating Plots

  The plotting script contains hardcoded values from experimental
  measurements. Run it to regenerate the 4 PNG plots:

  python3 MT25077_Part_D_Plots.py

  Plots generated:
    1. Throughput vs Message Size
    2. Latency vs Thread Count
    3. Cache Misses (L1) & Context Switches vs Message Size
    4. CPU Cycles per Byte vs Message Size

## Copy Semantics Summary

  Two-Copy (A1):
    Copy 1: struct fields[] -> contiguous send_buf  (user-space memcpy)
    Copy 2: send_buf -> kernel socket buffer         (send() syscall)

  One-Copy (A2):
    Eliminated: No user-space serialization
    Copy 1: iovec fields[] -> kernel socket buffer   (sendmsg() syscall)

  Zero-Copy (A3):
    Eliminated: No user-space serialization
    Eliminated: No user-to-kernel copy
    Kernel pins user-space pages, NIC DMA reads directly from them.
    Requires draining error queue for buffer completion notifications.
